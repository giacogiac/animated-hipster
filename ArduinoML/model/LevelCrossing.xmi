<?xml version="1.0" encoding="ASCII"?>
<arduinoml:Machine
    xmi:version="2.0"
    xmlns:xmi="http://www.omg.org/XMI"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:arduinoml="http://arduinoml/1.0"
    start="Open">
  <bricks xsi:type="arduinoml:Sensor"
      name="Barrier"
      pin="8"/>
  <bricks xsi:type="arduinoml:Actuator"
      name="RedLight"
      pin="9"/>
  <bricks xsi:type="arduinoml:Actuator"
      name="GreenLight"
      pin="10"/>
  <bricks xsi:type="arduinoml:Actuator"
      name="AlarmSignal"
      pin="11"/>
  <bricks xsi:type="arduinoml:Sensor"
      name="AlarmButton"
      pin="12"/>
  <states name="Open">
    <transitions
        goto="Close">
      <conditions
          xsi:type="arduinoml:DigitalSensorCondition"
          sensor="Barrier"/>
    </transitions>
    <transitions
        goto="AlarmRed">
      <conditions
          xsi:type="arduinoml:DigitalSensorCondition"
          bState="ON"
          sensor="AlarmButton"/>
    </transitions>
    <actions
        bState="ON"
        actuator="GreenLight"/>
    <actions
        actuator="RedLight"/>
    <actions
        actuator="AlarmSignal"/>
  </states>
  <states name="Close">
    <transitions
        goto="Open">
      <conditions
          xsi:type="arduinoml:DigitalSensorCondition"
          bState="ON"
          sensor="Barrier"/>
    </transitions>
    <transitions
        goto="AlarmRed">
      <conditions
          xsi:type="arduinoml:DigitalSensorCondition"
          bState="ON"
          sensor="AlarmButton"/>
    </transitions>
    <actions
        bState="ON"
        actuator="RedLight"/>
    <actions
        actuator="GreenLight"/>
    <actions
        actuator="AlarmSignal"/>
  </states>
  <states name="AlarmGreen">
    <transitions
        goto="AlarmRed">
      <conditions
          xsi:type="arduinoml:DigitalSensorCondition"
          bState="ON"
          sensor="AlarmButton"/>
      <conditions
          xsi:type="arduinoml:TimeCondition"
          time="500"/>
    </transitions>
    <transitions
        goto="Open">
      <conditions
          xsi:type="arduinoml:DigitalSensorCondition"
          sensor="AlarmButton"/>
    </transitions>
    <actions
        bState="ON"
        actuator="AlarmSignal"/>
    <actions
        bState="ON"
        actuator="GreenLight"/>
    <actions
        bState="ON"
        actuator="RedLight"/>
  </states>
  <states name="AlarmRed">
    <transitions
        goto="AlarmGreen">
      <conditions
          xsi:type="arduinoml:DigitalSensorCondition"
          bState="ON"
          sensor="AlarmButton"/>
      <conditions
          xsi:type="arduinoml:TimeCondition"
          time="500"/>
    </transitions>
    <transitions
        goto="Open">
      <conditions
          xsi:type="arduinoml:DigitalSensorCondition"
          sensor="AlarmButton"/>
    </transitions>
    <actions
        bState="ON"
        actuator="AlarmSignal"/>
    <actions
        bState="ON"
        actuator="RedLight"/>
    <actions
        actuator="GreenLight"/>
  </states>
</arduinoml:Machine>
